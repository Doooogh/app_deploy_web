{
    "sourceFile": "src/views/environment/index.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1731848213468,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1731848213468,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"page-container\">\n    <div class=\"operation-group\">\n      <el-button type=\"primary\" @click=\"handleAdd\">新增环境</el-button>\n    </div>\n\n    <el-table\n      v-loading=\"loading\"\n      :data=\"tableData\"\n      row-key=\"id\"\n    >\n      <el-table-column prop=\"name\" label=\"环境名称\" min-width=\"120\"></el-table-column>\n      <el-table-column prop=\"code\" label=\"环境标识\" width=\"120\"></el-table-column>\n      <el-table-column prop=\"description\" label=\"描述\" min-width=\"200\"></el-table-column>\n      <el-table-column prop=\"hostCount\" label=\"主机数量\" width=\"100\" align=\"center\"></el-table-column>\n      <el-table-column prop=\"projectCount\" label=\"项目数量\" width=\"100\" align=\"center\"></el-table-column>\n      <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"160\"></el-table-column>\n      <el-table-column label=\"状态\" width=\"100\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-tag :type=\"scope.row.status === 1 ? 'success' : 'info'\">\n            {{ scope.row.status === 1 ? '启用' : '禁用' }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" width=\"250\" fixed=\"right\">\n        <template slot-scope=\"scope\">\n          <el-button \n            type=\"text\" \n            @click=\"handleToggleStatus(scope.row)\"\n          >{{ scope.row.status === 1 ? '禁用' : '启用' }}</el-button>\n          <el-button type=\"text\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n          <el-button type=\"text\" @click=\"handleViewHosts(scope.row)\">查看主机</el-button>\n          <el-button \n            type=\"text\" \n            class=\"danger\" \n            @click=\"handleDelete(scope.row)\"\n            :disabled=\"scope.row.hostCount > 0\"\n          >删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <!-- 环境表单弹窗 -->\n    <environment-form-dialog\n      :visible.sync=\"formDialog.visible\"\n      :type=\"formDialog.type\"\n      :data=\"formDialog.data\"\n      @success=\"handleFormSuccess\"\n    ></environment-form-dialog>\n\n    <!-- 主机列表弹窗 -->\n    <el-dialog\n      :title=\"`${currentEnv.name} - 主机列表`\"\n      :visible.sync=\"hostDialog.visible\"\n      width=\"800px\"\n    >\n      <el-table\n        v-loading=\"hostDialog.loading\"\n        :data=\"hostDialog.list\"\n      >\n        <el-table-column prop=\"name\" label=\"主机名称\"></el-table-column>\n        <el-table-column prop=\"ip\" label=\"IP地址\"></el-table-column>\n        <el-table-column prop=\"port\" label=\"SSH端口\"></el-table-column>\n        <el-table-column prop=\"username\" label=\"用户名\"></el-table-column>\n        <el-table-column label=\"状态\" width=\"100\" align=\"center\">\n          <template slot-scope=\"scope\">\n            <el-tag :type=\"scope.row.status === 1 ? 'success' : 'danger'\">\n              {{ scope.row.status === 1 ? '在线' : '离线' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { \n  getEnvironmentList, \n  deleteEnvironment, \n  toggleEnvironmentStatus,\n  getEnvironmentHosts \n} from '@/api/environment'\nimport EnvironmentFormDialog from './components/EnvironmentFormDialog.vue'\n\nexport default {\n  name: 'Environment',\n  components: {\n    EnvironmentFormDialog\n  },\n  data() {\n    return {\n      loading: false,\n      tableData: [],\n      formDialog: {\n        visible: false,\n        type: 'add',\n        data: null\n      },\n      hostDialog: {\n        visible: false,\n        loading: false,\n        list: []\n      },\n      currentEnv: {}\n    }\n  },\n  created() {\n    this.getList()\n  },\n  methods: {\n    async getList() {\n      this.loading = true\n      try {\n        const { data } = await getEnvironmentList()\n        this.tableData = data\n      } catch (error) {\n        console.error(error)\n      }\n      this.loading = false\n    },\n    handleAdd() {\n      this.formDialog.type = 'add'\n      this.formDialog.data = null\n      this.formDialog.visible = true\n    },\n    handleEdit(row) {\n      this.formDialog.type = 'edit'\n      this.formDialog.data = { ...row }\n      this.formDialog.visible = true\n    },\n    async handleDelete(row) {\n      try {\n        await this.$confirm('确认删除该环境?', '提示', {\n          type: 'warning'\n        })\n        await deleteEnvironment(row.id)\n        this.$message.success('删除成功')\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    async handleToggleStatus(row) {\n      try {\n        const tipText = row.status === 1 ? '禁用' : '启用'\n        await this.$confirm(`确认${tipText}该环境?`, '提示', {\n          type: 'warning'\n        })\n        await toggleEnvironmentStatus(row.id)\n        this.$message.success(`${tipText}成功`)\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    async handleViewHosts(row) {\n      this.currentEnv = row\n      this.hostDialog.visible = true\n      this.hostDialog.loading = true\n      try {\n        const { data } = await getEnvironmentHosts(row.id)\n        this.hostDialog.list = data\n      } catch (error) {\n        console.error(error)\n      }\n      this.hostDialog.loading = false\n    },\n    handleFormSuccess() {\n      this.formDialog.visible = false\n      this.getList()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.danger {\n  color: $--color-danger;\n}\n</style> "
        }
    ]
}