{
    "sourceFile": "src/views/password/list.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1731848151830,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1731848151830,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"page-container\">\n    <div class=\"search-form\">\n      <el-form :inline=\"true\" :model=\"searchForm\" ref=\"searchForm\">\n        <el-form-item label=\"名称\">\n          <el-input v-model=\"searchForm.name\" placeholder=\"请输入名称\" clearable></el-input>\n        </el-form-item>\n        <el-form-item label=\"类型\">\n          <el-select v-model=\"searchForm.type\" placeholder=\"请选择类型\" clearable>\n            <el-option label=\"用户名密码\" value=\"password\"></el-option>\n            <el-option label=\"SSH密钥\" value=\"ssh\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n\n    <div class=\"operation-group\">\n      <el-button type=\"primary\" @click=\"handleAdd\">新增密码</el-button>\n      <el-button type=\"danger\" :disabled=\"!selectedIds.length\" @click=\"handleBatchDelete\">批量删除</el-button>\n    </div>\n\n    <el-table\n      v-loading=\"loading\"\n      :data=\"tableData\"\n      @selection-change=\"handleSelectionChange\"\n    >\n      <el-table-column type=\"selection\" width=\"55\"></el-table-column>\n      <el-table-column prop=\"name\" label=\"名称\" min-width=\"120\"></el-table-column>\n      <el-table-column prop=\"type\" label=\"类型\" width=\"120\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.type === 'password' ? '用户名密码' : 'SSH密钥' }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"username\" label=\"用户名\" min-width=\"120\"></el-table-column>\n      <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"160\"></el-table-column>\n      <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"text\" @click=\"handleView(scope.row)\">查看</el-button>\n          <el-button type=\"text\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n          <el-button type=\"text\" class=\"danger\" @click=\"handleDelete(scope.row)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-pagination\n      :current-page=\"page.current\"\n      :page-sizes=\"[10, 20, 50, 100]\"\n      :page-size=\"page.size\"\n      :total=\"page.total\"\n      layout=\"total, sizes, prev, pager, next, jumper\"\n      @size-change=\"handleSizeChange\"\n      @current-change=\"handleCurrentChange\"\n    ></el-pagination>\n\n    <!-- 查看密码弹窗 -->\n    <el-dialog title=\"查看密码\" :visible.sync=\"viewDialog.visible\" width=\"500px\">\n      <el-form label-width=\"80px\">\n        <el-form-item label=\"名称\">\n          <span>{{ viewDialog.data.name }}</span>\n        </el-form-item>\n        <el-form-item label=\"类型\">\n          <span>{{ viewDialog.data.type === 'password' ? '用户名密码' : 'SSH密钥' }}</span>\n        </el-form-item>\n        <el-form-item label=\"用户名\">\n          <span>{{ viewDialog.data.username }}</span>\n        </el-form-item>\n        <el-form-item label=\"密码\" v-if=\"viewDialog.data.type === 'password'\">\n          <el-input v-model=\"viewDialog.data.password\" type=\"password\" readonly>\n            <el-button slot=\"append\" @click=\"togglePasswordVisible\">\n              <i :class=\"passwordVisible ? 'el-icon-view' : 'el-icon-hide'\"></i>\n            </el-button>\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"私钥\" v-else>\n          <el-input\n            v-model=\"viewDialog.data.privateKey\"\n            type=\"textarea\"\n            :rows=\"4\"\n            readonly\n          ></el-input>\n        </el-form-item>\n      </el-form>\n    </el-dialog>\n\n    <!-- 编辑密码弹窗 -->\n    <password-form-dialog\n      :visible.sync=\"formDialog.visible\"\n      :type=\"formDialog.type\"\n      :data=\"formDialog.data\"\n      @success=\"handleFormSuccess\"\n    ></password-form-dialog>\n  </div>\n</template>\n\n<script>\nimport { getPasswordList, deletePassword, batchDeletePassword } from '@/api/password'\nimport PasswordFormDialog from './components/PasswordFormDialog.vue'\n\nexport default {\n  name: 'PasswordList',\n  components: {\n    PasswordFormDialog\n  },\n  data() {\n    return {\n      loading: false,\n      searchForm: {\n        name: '',\n        type: ''\n      },\n      tableData: [],\n      selectedIds: [],\n      page: {\n        current: 1,\n        size: 10,\n        total: 0\n      },\n      viewDialog: {\n        visible: false,\n        data: {}\n      },\n      formDialog: {\n        visible: false,\n        type: 'add',\n        data: null\n      },\n      passwordVisible: false\n    }\n  },\n  created() {\n    this.getList()\n  },\n  methods: {\n    async getList() {\n      this.loading = true\n      try {\n        const { data } = await getPasswordList({\n          ...this.searchForm,\n          page: this.page.current,\n          size: this.page.size\n        })\n        this.tableData = data.list\n        this.page.total = data.total\n      } catch (error) {\n        console.error(error)\n      }\n      this.loading = false\n    },\n    handleSearch() {\n      this.page.current = 1\n      this.getList()\n    },\n    resetSearch() {\n      this.$refs.searchForm.resetFields()\n      this.handleSearch()\n    },\n    handleSelectionChange(selection) {\n      this.selectedIds = selection.map(item => item.id)\n    },\n    handleAdd() {\n      this.formDialog.type = 'add'\n      this.formDialog.data = null\n      this.formDialog.visible = true\n    },\n    handleView(row) {\n      this.viewDialog.data = { ...row }\n      this.viewDialog.visible = true\n    },\n    handleEdit(row) {\n      this.formDialog.type = 'edit'\n      this.formDialog.data = { ...row }\n      this.formDialog.visible = true\n    },\n    async handleDelete(row) {\n      try {\n        await this.$confirm('确认删除该密码?', '提示', {\n          type: 'warning'\n        })\n        await deletePassword(row.id)\n        this.$message.success('删除成功')\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    async handleBatchDelete() {\n      try {\n        await this.$confirm(`确认删除选中的 ${this.selectedIds.length} 条数据?`, '提示', {\n          type: 'warning'\n        })\n        await batchDeletePassword(this.selectedIds)\n        this.$message.success('删除成功')\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    handleFormSuccess() {\n      this.formDialog.visible = false\n      this.getList()\n    },\n    handleSizeChange(val) {\n      this.page.size = val\n      this.getList()\n    },\n    handleCurrentChange(val) {\n      this.page.current = val\n      this.getList()\n    },\n    togglePasswordVisible() {\n      this.passwordVisible = !this.passwordVisible\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.danger {\n  color: $--color-danger;\n}\n</style> "
        }
    ]
}