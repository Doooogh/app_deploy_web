{
    "sourceFile": "src/views/script/index.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1731848659827,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1731848659827,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"page-container\">\n    <div class=\"search-form\">\n      <el-form :inline=\"true\" :model=\"searchForm\" ref=\"searchForm\">\n        <el-form-item label=\"脚本名称\">\n          <el-input v-model=\"searchForm.name\" placeholder=\"请输入脚本名称\" clearable></el-input>\n        </el-form-item>\n        <el-form-item label=\"脚本类型\">\n          <el-select v-model=\"searchForm.type\" placeholder=\"请选择脚本类型\" clearable>\n            <el-option label=\"Shell\" value=\"shell\"></el-option>\n            <el-option label=\"Python\" value=\"python\"></el-option>\n            <el-option label=\"Node.js\" value=\"nodejs\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n\n    <div class=\"operation-group\">\n      <el-button type=\"primary\" @click=\"handleAdd\">新增脚本</el-button>\n      <el-button type=\"danger\" :disabled=\"!selectedIds.length\" @click=\"handleBatchDelete\">批量删除</el-button>\n    </div>\n\n    <el-table\n      v-loading=\"loading\"\n      :data=\"tableData\"\n      @selection-change=\"handleSelectionChange\"\n    >\n      <el-table-column type=\"selection\" width=\"55\"></el-table-column>\n      <el-table-column prop=\"name\" label=\"脚本名称\" min-width=\"120\"></el-table-column>\n      <el-table-column prop=\"type\" label=\"脚本类型\" width=\"100\">\n        <template slot-scope=\"scope\">\n          {{ getScriptType(scope.row.type) }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"description\" label=\"描述\" min-width=\"200\" show-overflow-tooltip></el-table-column>\n      <el-table-column prop=\"params\" label=\"参数\" min-width=\"150\" show-overflow-tooltip>\n        <template slot-scope=\"scope\">\n          {{ scope.row.params ? scope.row.params.join(', ') : '-' }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"creator\" label=\"创建人\" width=\"120\"></el-table-column>\n      <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"160\"></el-table-column>\n      <el-table-column label=\"操作\" width=\"250\" fixed=\"right\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"text\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n          <el-button type=\"text\" @click=\"handleTest(scope.row)\">测试</el-button>\n          <el-button type=\"text\" @click=\"handleCopy(scope.row)\">复制</el-button>\n          <el-button type=\"text\" class=\"danger\" @click=\"handleDelete(scope.row)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-pagination\n      :current-page=\"page.current\"\n      :page-sizes=\"[10, 20, 50, 100]\"\n      :page-size=\"page.size\"\n      :total=\"page.total\"\n      layout=\"total, sizes, prev, pager, next, jumper\"\n      @size-change=\"handleSizeChange\"\n      @current-change=\"handleCurrentChange\"\n    ></el-pagination>\n\n    <!-- 脚本表单弹窗 -->\n    <script-form-dialog\n      :visible.sync=\"formDialog.visible\"\n      :type=\"formDialog.type\"\n      :data=\"formDialog.data\"\n      @success=\"handleFormSuccess\"\n    ></script-form-dialog>\n\n    <!-- 脚本测试弹窗 -->\n    <script-test-dialog\n      :visible.sync=\"testDialog.visible\"\n      :data=\"testDialog.data\"\n    ></script-test-dialog>\n  </div>\n</template>\n\n<script>\nimport { \n  getScriptList, \n  deleteScript, \n  batchDeleteScript,\n  copyScript \n} from '@/api/script'\nimport ScriptFormDialog from './components/ScriptFormDialog.vue'\nimport ScriptTestDialog from './components/ScriptTestDialog.vue'\n\nexport default {\n  name: 'Script',\n  components: {\n    ScriptFormDialog,\n    ScriptTestDialog\n  },\n  data() {\n    return {\n      loading: false,\n      searchForm: {\n        name: '',\n        type: ''\n      },\n      tableData: [],\n      selectedIds: [],\n      page: {\n        current: 1,\n        size: 10,\n        total: 0\n      },\n      formDialog: {\n        visible: false,\n        type: 'add',\n        data: null\n      },\n      testDialog: {\n        visible: false,\n        data: null\n      }\n    }\n  },\n  created() {\n    this.getList()\n  },\n  methods: {\n    getScriptType(type) {\n      const map = {\n        shell: 'Shell',\n        python: 'Python',\n        nodejs: 'Node.js'\n      }\n      return map[type] || type\n    },\n    async getList() {\n      this.loading = true\n      try {\n        const { data } = await getScriptList({\n          ...this.searchForm,\n          page: this.page.current,\n          size: this.page.size\n        })\n        this.tableData = data.list\n        this.page.total = data.total\n      } catch (error) {\n        console.error(error)\n      }\n      this.loading = false\n    },\n    handleSearch() {\n      this.page.current = 1\n      this.getList()\n    },\n    resetSearch() {\n      this.$refs.searchForm.resetFields()\n      this.handleSearch()\n    },\n    handleSelectionChange(selection) {\n      this.selectedIds = selection.map(item => item.id)\n    },\n    handleAdd() {\n      this.formDialog.type = 'add'\n      this.formDialog.data = null\n      this.formDialog.visible = true\n    },\n    handleEdit(row) {\n      this.formDialog.type = 'edit'\n      this.formDialog.data = { ...row }\n      this.formDialog.visible = true\n    },\n    async handleDelete(row) {\n      try {\n        await this.$confirm('确认删除该脚本?', '提示', {\n          type: 'warning'\n        })\n        await deleteScript(row.id)\n        this.$message.success('删除成功')\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    async handleBatchDelete() {\n      try {\n        await this.$confirm(`确认删除选中的 ${this.selectedIds.length} 个脚本?`, '提示', {\n          type: 'warning'\n        })\n        await batchDeleteScript(this.selectedIds)\n        this.$message.success('删除成功')\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    handleTest(row) {\n      this.testDialog.data = row\n      this.testDialog.visible = true\n    },\n    async handleCopy(row) {\n      try {\n        await copyScript(row.id)\n        this.$message.success('复制成功')\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    handleFormSuccess() {\n      this.formDialog.visible = false\n      this.getList()\n    },\n    handleSizeChange(val) {\n      this.page.size = val\n      this.getList()\n    },\n    handleCurrentChange(val) {\n      this.page.current = val\n      this.getList()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.danger {\n  color: $--color-danger;\n}\n</style> "
        }
    ]
}