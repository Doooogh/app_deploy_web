{
    "sourceFile": "src/views/project/index.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1731848406890,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1731848406890,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"page-container\">\n    <div class=\"search-form\">\n      <el-form :inline=\"true\" :model=\"searchForm\" ref=\"searchForm\">\n        <el-form-item label=\"项目名称\">\n          <el-input v-model=\"searchForm.name\" placeholder=\"请输入项目名称\" clearable></el-input>\n        </el-form-item>\n        <el-form-item label=\"仓库类型\">\n          <el-select v-model=\"searchForm.repoType\" placeholder=\"请选择仓库类型\" clearable>\n            <el-option label=\"Git\" value=\"git\"></el-option>\n            <el-option label=\"SVN\" value=\"svn\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n\n    <div class=\"operation-group\">\n      <el-button type=\"primary\" @click=\"handleAdd\">新增项目</el-button>\n    </div>\n\n    <el-table\n      v-loading=\"loading\"\n      :data=\"tableData\"\n    >\n      <el-table-column prop=\"name\" label=\"项目名称\" min-width=\"120\"></el-table-column>\n      <el-table-column prop=\"repoType\" label=\"仓库类型\" width=\"100\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.repoType === 'git' ? 'Git' : 'SVN' }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"repoUrl\" label=\"仓库地址\" min-width=\"200\" show-overflow-tooltip></el-table-column>\n      <el-table-column prop=\"branch\" label=\"分支/标签\" width=\"120\"></el-table-column>\n      <el-table-column prop=\"versionCount\" label=\"版本数量\" width=\"100\" align=\"center\"></el-table-column>\n      <el-table-column prop=\"deployCount\" label=\"部署次数\" width=\"100\" align=\"center\"></el-table-column>\n      <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"160\"></el-table-column>\n      <el-table-column label=\"操作\" width=\"280\" fixed=\"right\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"text\" @click=\"handleVersion(scope.row)\">版本管理</el-button>\n          <el-button type=\"text\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n          <el-button type=\"text\" @click=\"handleDeploy(scope.row)\">发布</el-button>\n          <el-button type=\"text\" class=\"danger\" @click=\"handleDelete(scope.row)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-pagination\n      :current-page=\"page.current\"\n      :page-sizes=\"[10, 20, 50, 100]\"\n      :page-size=\"page.size\"\n      :total=\"page.total\"\n      layout=\"total, sizes, prev, pager, next, jumper\"\n      @size-change=\"handleSizeChange\"\n      @current-change=\"handleCurrentChange\"\n    ></el-pagination>\n\n    <!-- 项目表单弹窗 -->\n    <project-form-dialog\n      :visible.sync=\"formDialog.visible\"\n      :type=\"formDialog.type\"\n      :data=\"formDialog.data\"\n      @success=\"handleFormSuccess\"\n    ></project-form-dialog>\n  </div>\n</template>\n\n<script>\nimport { getProjectList, deleteProject } from '@/api/project'\nimport ProjectFormDialog from './components/ProjectFormDialog.vue'\n\nexport default {\n  name: 'Project',\n  components: {\n    ProjectFormDialog\n  },\n  data() {\n    return {\n      loading: false,\n      searchForm: {\n        name: '',\n        repoType: ''\n      },\n      tableData: [],\n      page: {\n        current: 1,\n        size: 10,\n        total: 0\n      },\n      formDialog: {\n        visible: false,\n        type: 'add',\n        data: null\n      }\n    }\n  },\n  created() {\n    this.getList()\n  },\n  methods: {\n    async getList() {\n      this.loading = true\n      try {\n        const { data } = await getProjectList({\n          ...this.searchForm,\n          page: this.page.current,\n          size: this.page.size\n        })\n        this.tableData = data.list\n        this.page.total = data.total\n      } catch (error) {\n        console.error(error)\n      }\n      this.loading = false\n    },\n    handleSearch() {\n      this.page.current = 1\n      this.getList()\n    },\n    resetSearch() {\n      this.$refs.searchForm.resetFields()\n      this.handleSearch()\n    },\n    handleAdd() {\n      this.formDialog.type = 'add'\n      this.formDialog.data = null\n      this.formDialog.visible = true\n    },\n    handleEdit(row) {\n      this.formDialog.type = 'edit'\n      this.formDialog.data = { ...row }\n      this.formDialog.visible = true\n    },\n    async handleDelete(row) {\n      try {\n        await this.$confirm('确认删除该项目?', '提示', {\n          type: 'warning'\n        })\n        await deleteProject(row.id)\n        this.$message.success('删除成功')\n        this.getList()\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    handleVersion(row) {\n      this.$router.push(`/project/version/${row.id}`)\n    },\n    handleDeploy(row) {\n      this.$router.push({\n        path: '/deploy/create',\n        query: {\n          projectId: row.id\n        }\n      })\n    },\n    handleFormSuccess() {\n      this.formDialog.visible = false\n      this.getList()\n    },\n    handleSizeChange(val) {\n      this.page.size = val\n      this.getList()\n    },\n    handleCurrentChange(val) {\n      this.page.current = val\n      this.getList()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.danger {\n  color: $--color-danger;\n}\n</style> "
        }
    ]
}